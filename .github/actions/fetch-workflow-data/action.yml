name: 'Fetch Workflow Data'
description: 'Fetches workflow run data and caches it for analysis'

inputs:
  workflow-name:
    description: 'Exact workflow name to match'
    required: false
  name-prefix:
    description: 'Workflow name prefix to match'
    required: false
  branch:
    description: 'Branch to filter runs by'
    required: false
  actor:
    description: 'Actor to filter runs by'
    required: false
  days:
    description: 'Number of days of data to fetch (default: 7)'
    required: false
  cache-path:
    description: 'Path to write the workflow data JSON (artifact)'
    required: false
  GITHUB_TOKEN:
    description: 'GitHub token for API access'
    required: true
  test_run_id:
    description: 'Run ID to use for testing (optional)'
    required: false
    default: ''

outputs:
  total-runs:
    description: 'Total number of runs fetched'
  workflow-count:
    description: 'Number of unique workflows found'
  cache-path:
    description: 'Absolute path to the written workflow data JSON file'
  commits-path:
    description: 'Absolute path to JSON array of commits on main in the last N days'
  annotations-root:
    description: 'Absolute path to directory containing per-run annotations'
  annotations-index-path:
    description: 'Absolute path to JSON mapping of run_id -> annotations dir'
  logs-root:
    description: 'Absolute path to directory containing downloaded logs per run (subset: failing gtest jobs)'
  logs-index-path:
    description: 'Absolute path to JSON mapping of run_id -> logs dir'

runs:
  using: 'node20'
  main: 'fetch-workflow-data.js'
