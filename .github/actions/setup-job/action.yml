name: Setup Job
description: Common setup steps for workflows
inputs:
  build-artifact-name:
    required: false
    description: Name of the build artifact
    default: ''
  wheel-artifact-name:
    required: false
    description: Name of the wheel artifact
    default: ''
  path:
    required: false
    description: Where to checkout
    default: docker-job
  create-venv:
    required: false
    description: Whether to create a virtual environment
    default: false
    type: boolean
runs:
  using: "composite"
  steps:
    - name: ğŸ§¬ Checkout Repository
      uses: actions/checkout@v4
      with:
        submodules: recursive
        path: ${{ inputs.path }}

    - name: ğŸ§ª Check Required Tools
      run: |
        echo "ğŸ” Verifying tools..."
        command -v tar >/dev/null 2>&1 && tar --version || { echo "âŒ tar not found"; exit 1; }
        command -v pip3 >/dev/null 2>&1 && pip3 --version || { echo "âŒ pip3 not found"; exit 1; }
      shell: bash

    - name: ğŸ“¦ Download Build Artifact
      if: ${{ inputs.build-artifact-name != '' }}
      uses: actions/download-artifact@v4
      with:
        name: ${{ inputs.build-artifact-name }}
        path: ${{ inputs.path }}

    - name: ğŸ“‚ Extract Build Files
      if: ${{ inputs.build-artifact-name != '' }}
      working-directory: ${{ inputs.path }}
      run: tar -xf ttm_any.tar
      shell: bash

    - name: ğŸ Create Virtual Environment
      if: ${{ inputs.create-venv }}
      working-directory: ${{ inputs.path }}
      run: ./create_venv.sh
      shell: bash

    - name: ğŸ§ª Download Python Wheel
      if: ${{ inputs.wheel-artifact-name != '' && !inputs.create-venv }}
      uses: actions/download-artifact@v4
      with:
        name: ${{ inputs.wheel-artifact-name }}
        path: ${{ inputs.path }}

    - name: ğŸ’¿ Install Wheel
      if: ${{ inputs.wheel-artifact-name != '' && !inputs.create-venv }}
      working-directory: ${{ inputs.path }}
      run: |
        echo "ğŸ“‚ In directory: $(pwd)"
        echo "ğŸ“„ Files:"
        ls -la
        WHEEL_FILENAME=$(ls -1 *.whl)
        echo "ğŸ“¦ Installing $WHEEL_FILENAME"
        pip3 install "$WHEEL_FILENAME"
      shell: bash
