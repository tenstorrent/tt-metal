name: "apc nightly debug run"

on:
  schedule:
    # Runs nightly at 12:00 AM UTC
    - cron: "0 0 * * *"
    # Runs nightly at 1:00 AM UTC with watcher enabled (Ubuntu 22.04 only)
    - cron: "0 1 * * *"

  workflow_dispatch:
    inputs:
      enable-lto:
        default: false
        type: boolean
        description: "Enable Link Time Optimization (LTO)"
      enable-watcher:
        default: false
        type: boolean
        description: "Enable watcher"

permissions:
  actions: read
  contents: write
  pull-requests: write
  pages: write
  id-token: write
  packages: write
  checks: write

jobs:
  nightly-debug:
    name: apc nightly debug run (${{ matrix.platform }}${{ (github.event.schedule == '0 1 * * *' || inputs.enable-watcher) && matrix.platform == 'Ubuntu 22.04' && ' with watcher' || '' }})
    if: ${{ github.event.schedule != '0 1 * * *' || github.event_name == 'workflow_dispatch' }}
    strategy:
      matrix:
        platform: ["Ubuntu 22.04", "Ubuntu 24.04"]
    uses: ./.github/workflows/all-post-commit-workflows.yaml
    secrets: inherit
    with:
      build-type: RelWithDebInfo
      platform: ${{ matrix.platform }}
      enable-lto: ${{ inputs.enable-lto || false }}

  nightly-debug-watcher:
    name: apc nightly debug run (${{ matrix.platform }} with watcher)
    if: ${{ github.event.schedule == '0 1 * * *' || (github.event_name == 'workflow_dispatch' && inputs.enable-watcher) }}
    strategy:
      matrix:
        platform: ["Ubuntu 22.04", "Ubuntu 24.04"]
    uses: ./.github/workflows/all-post-commit-workflows.yaml
    secrets: inherit
    with:
      build-type: RelWithDebInfo
      platform: ${{ matrix.platform }}
      enable-lto: ${{ inputs.enable-lto || false }}
      enable-watcher: true
      run-profiler-regression: false
      run-models-unit-tests: false
      run-ops-unit-tests: false
