name: Analyze ND Failures

on:
  workflow_dispatch:
    inputs:
      update_mode:
        description: 'Mode: update (sync new errors) or rebuild (recreate all issues)'
        required: false
        default: 'update'
        type: choice
        options:
          - update
          - rebuild
      run_maintenance:
        description: 'Run maintenance (cleanup old runs, ensure sorting)'
        required: false
        default: false
        type: boolean
      start_date:
        description: 'Start date for fetching Slack messages (format: January 1, 2026)'
        required: false
        default: 'January 1, 2026'
        type: string

jobs:
  analyze-nd-failures:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run analyze nd failures
        uses: tenstorrent-metal/tt-auto-triage/.github/actions/slack_output_analysis@main
        with:
          # TODO: Configure these secrets in repository settings -> Secrets and variables -> Actions
          # github_token: Personal Access Token for creating/updating GitHub issues
          github_token: ${{ secrets.EVAN_PAT }}
          # slack_token: Slack Bot Token for fetching messages
          slack_token: ${{ secrets.SLACK_BOT_TOKEN }}
          # channel_id: Slack channel ID to fetch messages from
          channel_id: ${{ secrets.SLACK_METAL_INFRA_CHANNEL_ID }}
          update_mode: ${{ inputs.update_mode || 'update' }}
          run_maintenance: ${{ inputs.run_maintenance || 'false' }}
          start_date: ${{ inputs.start_date || 'January 1, 2026' }}
