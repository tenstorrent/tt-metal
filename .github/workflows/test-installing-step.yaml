name: Test INSTALLING.md install.sh step

on:
  workflow_dispatch:
    inputs:
      runner-label:
        description: Runner label (e.g., N150)
        required: false
        default: N150

jobs:
  install-and-run-mnist:
    name: Install deps and run MNIST MLP
    runs-on: ${{ format('tt-ubuntu-2204-{0}-viommu-stable', github.event.inputs.runner-label || 'N150') }}
    timeout-minutes: 60
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install TT dependencies via TT-Installer
        shell: bash
        run: |
          set -euo pipefail
          export PATH=/home/ubuntu/.local/bin:$PATH
          curl -fsSL https://github.com/tenstorrent/tt-installer/releases/latest/download/install.sh -O
          chmod +x install.sh
          ./install.sh \
            --smi-version=v3.0.38 \
            --fw-version=19.2.0 \
            --kmd-version=2.5.0 \
            --install-container-runtime=no \
            --metalium-container=models

      - name: Run MNIST MLP via tt-metalium-models
        shell: bash
        run: |
          set -euo pipefail
          export PATH=/home/ubuntu/.local/bin:$PATH
          tt-metalium-models -c "python3 ttnn/tutorials/basic_python/ttnn_mlp_inference_mnist.py"
