// SPDX-FileCopyrightText: Â© 2025 Tenstorrent AI ULC
//
// SPDX-License-Identifier: Apache-2.0

syntax = "proto3";

package tt.telemetry;

// The telemetry gRPC service
service TelemetryService {
  // Simple ping/pong to measure RTT
  rpc Ping(PingRequest) returns (PingResponse) {}

  // Query a metric by name
  rpc QueryMetric(QueryMetricRequest) returns (QueryMetricResponse) {}
}

// Ping request carrying a timestamp
message PingRequest {
  int64 timestamp = 1;  // Client timestamp (milliseconds since epoch)
}

// Pong response echoing the timestamp
message PingResponse {
  int64 timestamp = 1;  // Echo of the client's timestamp
}

// Query request for a specific metric
message QueryMetricRequest {
  string metric_name = 1;  // Name of the metric to query
}

// Individual metric result with path, timestamp, and value
message BoolMetricResult {
  string path = 1;         // Full metric path
  uint64 timestamp = 2;    // Timestamp when sampled (milliseconds since epoch)
  bool value = 3;          // Metric value
}

message UintMetricResult {
  string path = 1;         // Full metric path
  uint64 timestamp = 2;    // Timestamp when sampled (milliseconds since epoch)
  uint64 value = 3;        // Metric value
}

message DoubleMetricResult {
  string path = 1;         // Full metric path
  uint64 timestamp = 2;    // Timestamp when sampled (milliseconds since epoch)
  double value = 3;        // Metric value
}

message StringMetricResult {
  string path = 1;         // Full metric path
  uint64 timestamp = 2;    // Timestamp when sampled (milliseconds since epoch)
  string value = 3;        // Metric value
}

// Query response with arrays of typed results
message QueryMetricResponse {
  repeated BoolMetricResult bool_results = 1;
  repeated UintMetricResult uint_results = 2;
  repeated DoubleMetricResult double_results = 3;
  repeated StringMetricResult string_results = 4;
}
