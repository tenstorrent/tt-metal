# Example: Mesh with Subdivided ASIC Locations Using Custom Groupings
# This example shows defining a custom grouping called "halftray" multiple times
# with different ASIC locations, both representing a half tray concept

# Custom grouping: Half tray - defined multiple times with different ASIC locations
# Both represent the same "half tray" concept
groupings {
  custom_name: "halftray"
  instances: [
    { id: 0 asic_location: ASIC_LOCATION_1 },  # Lower half (locations 1-4)
    { id: 1 asic_location: ASIC_LOCATION_2 },
    { id: 2 asic_location: ASIC_LOCATION_3 },
    { id: 3 asic_location: ASIC_LOCATION_4 }
  ]
  row_major_mesh {
    dims: [1, 4]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
}

groupings {
  custom_name: "halftray"
  instances: [
    { id: 0 asic_location: ASIC_LOCATION_5 },  # Upper half (locations 5-8)
    { id: 1 asic_location: ASIC_LOCATION_6 },
    { id: 2 asic_location: ASIC_LOCATION_7 },
    { id: 3 asic_location: ASIC_LOCATION_8 }
  ]
  row_major_mesh {
    dims: [1, 4]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
}

groupings {
  custom_name: "meshes"
  instances: [
    { id: 0 grouping_ref { custom_name: "halftray" } }  # Each mesh uses 1 half tray (can be either lower or upper)
  ]
}

groupings {
  custom_name: "pods"
  instances: [
    { id: 0 grouping_ref { custom_name: "meshes" } },  # Must have at least 2 instances
    { id: 1 grouping_ref { custom_name: "meshes" } }
  ]
  all_to_all { num_connections: 2 }
}

groupings {
  custom_name: "superpods"
  instances: [
    { id: 0 grouping_ref { custom_name: "pods" } },  # Must have at least 2 instances
    { id: 1 grouping_ref { custom_name: "pods" } }
  ]
  all_to_all { num_connections: 2 }
}

groupings {
  custom_name: "clusters"
  instances: [
    { id: 0 grouping_ref { custom_name: "superpods" } },  # Must have at least 2 instances
    { id: 1 grouping_ref { custom_name: "superpods" } }
  ]
  all_to_all { num_connections: 2 }
}
