# Example: Mixed Counts - Combining Different Grouping Types
# This example shows mixing different types of lower-level groupings within a single grouping
# Uses predefined keywords: TRAY_1-TRAY_4, HOSTS, and MESH

# TRAY_1: Top left corner is ASIC_LOCATION_1
groupings {
  preset_name: TRAY_1
  instances: [
    { id: 0 asic_location: ASIC_LOCATION_1 },
    { id: 1 asic_location: ASIC_LOCATION_2 },
    { id: 2 asic_location: ASIC_LOCATION_3 },
    { id: 3 asic_location: ASIC_LOCATION_4 },
    { id: 4 asic_location: ASIC_LOCATION_5 },
    { id: 5 asic_location: ASIC_LOCATION_6 },
    { id: 6 asic_location: ASIC_LOCATION_7 },
    { id: 7 asic_location: ASIC_LOCATION_8 }
  ]
  row_major_mesh {
    dims: [2, 4]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
}

# TRAY_2: Top right corner is ASIC_LOCATION_1
groupings {
  preset_name: TRAY_2
  instances: [
    { id: 0 asic_location: ASIC_LOCATION_4 },
    { id: 1 asic_location: ASIC_LOCATION_3 },
    { id: 2 asic_location: ASIC_LOCATION_2 },
    { id: 3 asic_location: ASIC_LOCATION_1 },
    { id: 4 asic_location: ASIC_LOCATION_8 },
    { id: 5 asic_location: ASIC_LOCATION_7 },
    { id: 6 asic_location: ASIC_LOCATION_6 },
    { id: 7 asic_location: ASIC_LOCATION_5 }
  ]
  row_major_mesh {
    dims: [2, 4]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
}

# TRAY_3: Bottom left corner is ASIC_LOCATION_1
groupings {
  preset_name: TRAY_3
  instances: [
    { id: 0 asic_location: ASIC_LOCATION_5 },
    { id: 1 asic_location: ASIC_LOCATION_6 },
    { id: 2 asic_location: ASIC_LOCATION_7 },
    { id: 3 asic_location: ASIC_LOCATION_8 },
    { id: 4 asic_location: ASIC_LOCATION_1 },
    { id: 5 asic_location: ASIC_LOCATION_2 },
    { id: 6 asic_location: ASIC_LOCATION_3 },
    { id: 7 asic_location: ASIC_LOCATION_4 }
  ]
  row_major_mesh {
    dims: [2, 4]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
}

# TRAY_4: Bottom right corner is ASIC_LOCATION_1
groupings {
  preset_name: TRAY_4
  instances: [
    { id: 0 asic_location: ASIC_LOCATION_8 },
    { id: 1 asic_location: ASIC_LOCATION_7 },
    { id: 2 asic_location: ASIC_LOCATION_6 },
    { id: 3 asic_location: ASIC_LOCATION_5 },
    { id: 4 asic_location: ASIC_LOCATION_4 },
    { id: 5 asic_location: ASIC_LOCATION_3 },
    { id: 6 asic_location: ASIC_LOCATION_2 },
    { id: 7 asic_location: ASIC_LOCATION_1 }
  ]
  row_major_mesh {
    dims: [2, 4]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
}

# HOSTS: 4 trays (TRAY_1, TRAY_2, TRAY_3, TRAY_4)
groupings {
  preset_name: HOSTS
  instances: [
    { id: 0 grouping_ref { preset_name: TRAY_1 } },
    { id: 1 grouping_ref { preset_name: TRAY_2 } },
    { id: 2 grouping_ref { preset_name: TRAY_3 } },
    { id: 3 grouping_ref { preset_name: TRAY_4 } }
  ]
  row_major_mesh {
    dims: [1, 4]
    dim_types: [LINE, RING]
    num_connections: 2
  }
}

# MESH: 8 instances arranged in 2x4 grid with row-major mesh connectivity
groupings {
  preset_name: MESH
  instances: [
    { id: 0 grouping_ref { preset_name: HOSTS } },
    { id: 1 grouping_ref { preset_name: HOSTS } },
    { id: 2 grouping_ref { preset_name: HOSTS } },
    { id: 3 grouping_ref { preset_name: HOSTS } },
    { id: 4 grouping_ref { preset_name: HOSTS } },
    { id: 5 grouping_ref { preset_name: HOSTS } },
    { id: 6 grouping_ref { preset_name: HOSTS } },
    { id: 7 grouping_ref { preset_name: HOSTS } }
  ]
  row_major_mesh {
    dims: [2, 4]
    dim_types: [LINE, RING]
    num_connections: 2
  }
}

# Custom meshes (smaller mesh example)
groupings {
  custom_name: "meshes"
  instances: [
    { id: 0 grouping_ref { preset_name: HOSTS } }  # Each mesh = 1 host (meshes can have 1 instance)
  ]
}

groupings {
  custom_name: "pods"
  instances: [
    { id: 0 grouping_ref { custom_name: "meshes" } },  # Each pod contains 2 meshes
    { id: 1 grouping_ref { custom_name: "meshes" } }
  ]
  all_to_all { num_connections: 2 }
}

# Superpod mixing pods and meshes
groupings {
  custom_name: "superpods"
  instances: [
    { id: 0 grouping_ref { custom_name: "pods" } },  # Contains 2 pods
    { id: 1 grouping_ref { custom_name: "pods" } },
    { id: 2 grouping_ref { custom_name: "meshes" } },  # Also contains 4 meshes directly (mixed with pods)
    { id: 3 grouping_ref { custom_name: "meshes" } },
    { id: 4 grouping_ref { custom_name: "meshes" } },
    { id: 5 grouping_ref { custom_name: "meshes" } }
  ]
  all_to_all { num_connections: 2 }
  # Example: 2 pods + 4 meshes = 8 total meshes (2 from pods + 4 direct)
}

# Cluster mixing superpods, pods, and meshes
groupings {
  custom_name: "clusters"
  instances: [
    { id: 0 grouping_ref { custom_name: "superpods" } },  # Contains 2 superpods
    { id: 1 grouping_ref { custom_name: "superpods" } },
    { id: 2 grouping_ref { custom_name: "pods" } },  # Also contains 2 pods directly
    { id: 3 grouping_ref { custom_name: "pods" } },
    { id: 4 grouping_ref { custom_name: "meshes" } },  # Also contains 3 meshes directly
    { id: 5 grouping_ref { custom_name: "meshes" } },
    { id: 6 grouping_ref { custom_name: "meshes" } }
  ]
  row_major_mesh {
    dims: [7, 1]
    dim_types: [LINE, LINE]
    num_connections: 2
  }
  # Example: 2 superpods (each with 2 pods + 4 meshes) + 2 pods + 3 meshes
}
