# --- Meshes ---------------------------------------------------------------

mesh_descriptors {
  name: "M0"
  arch: WORMHOLE_B0
  device_topology {
    dims: [ 8, 4 ]
    dim_types: [ LINE, RING ]
  }
  host_topology   { dims: [1, 1] }
  channels {
    count: 4
    policy: STRICT
  }
  express_connections { src: 0 dst: 4 }
  express_connections { src: 1 dst: 5 }
  express_connections { src: 2 dst: 6 }
  express_connections { src: 3 dst: 7 }
}

mesh_descriptors {
  name: "M1"
  arch: WORMHOLE_B0
  device_topology {
    dims: [ 8, 4 ]
  }
  host_topology   { dims: [1, 2] }
  channels {
    count: 4
    policy: STRICT
  }
}

mesh_descriptors {
  name: "M2"
  arch: WORMHOLE_B0
  device_topology {
    dims: [ 8, 4 ]
  }
  host_topology   { dims: [1, 1] }
  channels {
    count: 2
    policy: STRICT
  }
}

mesh_descriptors {
  name: "M3"
  arch: WORMHOLE_B0
  device_topology {
    dims: [ 8, 4 ]
  }
  host_topology   { dims: [1, 1] }
  channels {
    count: 2
    policy: STRICT
  }
}

mesh_descriptors {
  name: "M4"
  arch: WORMHOLE_B0
  device_topology {
    dims: [ 8, 4 ]
  }
  host_topology   { dims: [1, 1] }
  channels {
    count: 2
    policy: STRICT
  }
}


# --- Graphs ---------------------------------------------------------------

graph_descriptors {
  name: "G0"
  type: "POD"
  instances { mesh { mesh_descriptor: "M0" mesh_id: 0 } }
  instances { mesh { mesh_descriptor: "M1" mesh_id: 0 } }
  connections {
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 0 device_id: 0 } }
    nodes { mesh { mesh_descriptor: "M1" mesh_id: 0 device_id: 0 } }
    channels { count: 2 policy: RELAXED }
    directional: false
  }
}

graph_descriptors {
  name: "G1"
  type: "POD"
  channels { count: 2 policy: RELAXED }
  instances { mesh { mesh_descriptor: "M2" mesh_id: 0 } }
  instances { mesh { mesh_descriptor: "M3" mesh_id: 0 } }
  instances { mesh { mesh_descriptor: "M4" mesh_id: 0 } }
  graph_topology: { layout_type: ALL_TO_ALL }
}

graph_descriptors {
  name: "G2"
  type: "CLUSTER"
  channels { count: 2 policy: RELAXED }
  instances { graph { graph_descriptor: "G1" graph_id: 0 } }
  instances { graph { graph_descriptor: "G0" graph_id: 0 } }
  graph_topology: { layout_type: ALL_TO_ALL }
}

# --- Instantiation ----------------------------------------------------------
top_level_instance { graph { graph_descriptor: "G2" graph_id: 0 } }
