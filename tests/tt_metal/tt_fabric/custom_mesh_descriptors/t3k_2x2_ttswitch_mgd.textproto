# --- Meshes ---------------------------------------------------------------
# 2x2 compute meshes for T3k

mesh_descriptors {
  name: "M0"
  arch: WORMHOLE_B0
  device_topology { dims: [ 2, 2 ] }
  host_topology   { dims: [ 1, 1 ] }
  channels {
    count: 2
    policy: STRICT
  }
}

# --- Switches ---------------------------------------------------------------
# TT-Switch connecting the compute meshes

switch_descriptors {
  name: "SW0"
  arch: WORMHOLE_B0
  device_topology { dims: [ 2, 2 ] }
  channels {
    count: 2
    policy: STRICT
  }
}

# --- Graphs ---------------------------------------------------------------
# Graph with 1 compute mesh and 1 TT-Switch

graph_descriptors {
  name: "G0"
  type: "FABRIC"
  instances { mesh { mesh_descriptor: "M0" mesh_id: 0 } }
  instances { switch { switch_descriptor: "SW0" switch_id: 1 } }

  # Connect compute mesh 0 to switch
  connections {
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 0 } }
    nodes { switch { switch_descriptor: "SW0" switch_id: 1 } }
    channels { count: 2 }
  }
}

# --- Instantiation ----------------------------------------------------------
top_level_instance { graph { graph_descriptor: "G0" graph_id: 0 } }
