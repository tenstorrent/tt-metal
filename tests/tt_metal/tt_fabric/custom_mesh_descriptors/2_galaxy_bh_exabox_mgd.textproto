# SPDX-FileCopyrightText: © 2025 Tenstorrent Inc.
# SPDX-License-Identifier: Apache-2.0
#
# Mesh Graph Descriptor for 2-Galaxy Exabox Configuration (Blackhole)
#
# Topology: Two Galaxy units (4×8 each = 32 devices) connected via Ethernet
# Use case: Disaggregated prefill/decode, KV cache transfer benchmarking
#
# --- Meshes ---------------------------------------------------------------

mesh_descriptors {
  name: "Galaxy_4x8"
  arch: BLACKHOLE
  device_topology { dims: [ 4, 8 ] }  # Galaxy: 32 devices (4 rows × 8 cols)
  host_topology   { dims: [ 1, 1 ] }  # Single host per Galaxy
  channels {
    count: 2
    policy: RELAXED
  }
}

# --- Graphs ---------------------------------------------------------------

graph_descriptors {
  name: "G0"
  type: "FABRIC"

  # Two Galaxy instances: mesh_id=0 (sender), mesh_id=1 (receiver)
  instances { mesh { mesh_descriptor: "Galaxy_4x8" mesh_id: 0 } }
  instances { mesh { mesh_descriptor: "Galaxy_4x8" mesh_id: 1 } }

  # Connection between the two Galaxies (4 ethernet channels)
  connections {
    nodes { mesh { mesh_descriptor: "Galaxy_4x8" mesh_id: 0 } }
    nodes { mesh { mesh_descriptor: "Galaxy_4x8" mesh_id: 1 } }
    channels { count: 4 policy: STRICT }
    directional: false
    assign_z_direction: true
  }
}

# --- Instantiation ----------------------------------------------------------
top_level_instance { graph { graph_descriptor: "G0" graph_id: 0 } }
