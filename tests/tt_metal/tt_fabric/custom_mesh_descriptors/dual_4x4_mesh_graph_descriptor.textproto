# --- Meshes ---------------------------------------------------------------

mesh_descriptors {
  name: "M0"
  arch: WORMHOLE_B0
  device_topology { dims: [ 4, 4 ] }
  host_topology   { dims: [ 1, 1 ] }
  channels {
    count: 2
    policy: RELAXED
  }
}

# --- Graphs ---------------------------------------------------------------

graph_descriptors {
  name: "G0"
  type: "FABRIC"
  # Instances: mesh ids 0..1 (all 4x4)
  instances { mesh { mesh_descriptor: "M0" mesh_id: 0 } }
  instances { mesh { mesh_descriptor: "M0" mesh_id: 1 } }

  # Strict connections between specific devices
  # For 4x4 mesh: connect bottom row of M0 to top row of M1
  # M0 D12 (row 3, col 0) <-> M1 D0 (row 0, col 0)
  connections {
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 0 device_id: 12 } }
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 1 device_id: 0 } }
    channels { count: 2 policy: STRICT }
  }
  connections {
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 0 device_id: 13 } }
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 1 device_id: 1 } }
    channels { count: 2 policy: STRICT }
  }
  connections {
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 0 device_id: 14 } }
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 1 device_id: 2 } }
    channels { count: 2 policy: STRICT }
  }
  connections {
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 0 device_id: 15 } }
    nodes { mesh { mesh_descriptor: "M0" mesh_id: 1 device_id: 3 } }
    channels { count: 2 policy: STRICT }
  }
}

# --- Instantiation ----------------------------------------------------------
top_level_instance { graph { graph_descriptor: "G0" graph_id: 0 } }

pinnings {
  logical_fabric_node_id { mesh_id: 0 chip_id: 0 }
  physical_asic_position { tray_id: 1 asic_location: 1 }
}
pinnings {
  logical_fabric_node_id { mesh_id: 0 chip_id: 3 }
  physical_asic_position { tray_id: 2 asic_location: 1 }
}
pinnings {
  logical_fabric_node_id { mesh_id: 0 chip_id: 15 }
  physical_asic_position { tray_id: 2 asic_location: 4 }
}
pinnings {
  logical_fabric_node_id { mesh_id: 1 chip_id: 0 }
  physical_asic_position { tray_id: 3 asic_location: 4 }
}
pinnings {
  logical_fabric_node_id { mesh_id: 1 chip_id: 3 }
  physical_asic_position { tray_id: 4 asic_location: 4 }
}
pinnings {
  logical_fabric_node_id { mesh_id: 1 chip_id: 15 }
  physical_asic_position { tray_id: 4 asic_location: 1 }
}
