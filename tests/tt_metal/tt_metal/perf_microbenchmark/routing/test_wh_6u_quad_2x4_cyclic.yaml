# SPDX-FileCopyrightText: Â© 2025 Tenstorrent AI ULC
#
# SPDX-License-Identifier: Apache-2.0
# Run this with the following command:
# tt-run --rank-binding tests/tt_metal/distributed/config/wh_galaxy_2x4_rank_bindings.yaml --mpi-args "--allow-run-as-root --tag-output" ./build/test/tt_metal/perf_microbenchmark/routing/test_tt_fabric --test_config tests/tt_metal/tt_metal/perf_microbenchmark/routing/test_wh_6u_quad_2x4_cyclic.yaml
#
Tests:
  # ======================================================================================
  # Inter Mesh Cycle Hang: Inter-Mesh Directed Traffic
  # ======================================================================================
  - name: InterMeshCrossTraffic
    sync: true
    skip_packet_validation: true
    fabric_setup:
      topology: Mesh
    parametrization_params:
      size: [2048, 4096]
    defaults:
      ftype: unicast
      ntype: unicast_write
      num_packets: 50000
    senders:
      - device: [0, 7]
        patterns:
          - destination:
              device: [3, 7]
      - device: [3, 4]
        patterns:
          - destination:
              device: [2, 4]
      - device: [2, 7]
        patterns:
          - destination:
              device: [1, 7]
      - device: [1, 4]
        patterns:
          - destination:
              device: [0, 4]

  - name: "FlowControlCyclicMultiMesh"
    enable_flow_control: true
    sync: true
    fabric_setup:
      topology: Mesh

    parametrization_params:
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      size: [1024, 2048, 4096]

    defaults:
      ftype: unicast
      num_packets: 10000

    patterns:
      - type: all_to_all
