# SPDX-FileCopyrightText: Â© 2025 Tenstorrent AI ULC
#
# SPDX-License-Identifier: Apache-2.0
# Run this with the following command:
# tt-run --rank-binding tests/tt_metal/distributed/config/dual_4x4_rank_bindings.yaml --mpi-args "--allow-run-as-root --tag-output" ./build/test/tt_metal/perf_microbenchmark/routing/test_tt_fabric --test_config tests/tt_metal/tt_metal/perf_microbenchmark/routing/test_dual_4x4.yaml
Tests:
  # ======================================================================================
  # Test 1: Inter-Mesh Directed Traffic
  # ======================================================================================
  - name: InterMeshCrossTraffic
    sync: true
    enable_flow_control: true
    fabric_setup:
      topology: Mesh
    parametrization_params:
      size: [2048, 4096]
    defaults:
      ftype: unicast
      ntype: unicast_write
      num_packets: 50000
    senders:
      - device: [1, 0]
        patterns:
          - destination:
              device: [1, 1]
      - device: [0, 0]
        patterns:
          - destination:
              device: [0, 1]

  - name: InterMeshCrossTraffic
    sync: true
    fabric_setup:
      topology: Mesh
    parametrization_params:
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]
      size: [1024, 2048, 4096]
    defaults:
      ftype: unicast
      num_packets: 500000
    senders:
      - device: [0, [3, 2]]
        patterns:
          - destination:
              device: [1, [0, 0]]
      - device: [1, [0, 1]]
        patterns:
          - destination:
              device: [0, [3, 3]]

  - name: InterMeshCrossTrafficCyclic
    fabric_setup:
      topology: Mesh
    defaults:
      ftype: unicast
      ntype: unicast_write
      size: 1024
      num_packets: 10000
    senders:
      - device: [0, 14]
        patterns:
          - destination:
              device: [1, 2]
      - device: [1, 1]
        patterns:
          - destination:
              device: [0, 13]
      - device: [1, 3]
        patterns:
          - destination:
              device: [1, 0]
      - device: [0, 12]
        patterns:
          - destination:
              device: [0, 15]

  # - name: "FlowControlMultiMesh"
  #   sync: true
  #   fabric_setup:
  #     topology: Mesh

  #   defaults:
  #     ftype: unicast
  #     ntype: unicast_write
  #     size: 1024
  #     num_packets: 10000

  #   patterns:
  #     - type: all_to_all

  # - name: "FlowControlMultiMesh"
  #   sync: true
  #   benchmark_mode: true
  #   fabric_setup:
  #     topology: Mesh

  #   defaults:
  #     ftype: unicast
  #     ntype: unicast_write
  #     size: 4096
  #     num_packets: 50000

  #   patterns:
  #     - type: all_to_all

  # - name: InterMeshCrossTrafficCyclic
  #   fabric_setup:
  #     topology: Mesh
  #   defaults:
  #     ftype: unicast
  #     ntype: unicast_write
  #     size: 1024
  #     num_packets: 10000
  #   senders:
  #     - device: [0, 14]
  #       patterns:
  #         - destination:
  #             device: [1, 2]
  #     - device: [1, 1]
  #       patterns:
  #         - destination:
  #             device: [0, 13]
  #     - device: [1, 3]
  #       patterns:
  #         - destination:
  #             device: [1, 0]
  #     - device: [0, 12]
  #       patterns:
  #         - destination:
  #             device: [0, 15]
