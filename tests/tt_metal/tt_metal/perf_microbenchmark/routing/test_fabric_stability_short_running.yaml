# This is a short-running version of the fabric stability test. We can go to the longer
# running versions once we have more systems available for nightly tests.

# For bigger systems we may need to increase the number of configs per core
allocation_policies:
    receiver:
      max_configs_per_core: 1

Tests:
  - name: "LinearLooped"
    fabric_setup:
      topology: Linear

    top_level_iterations: 10

    parametrization_params:
      ftype: [unicast, mcast]
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]

    defaults:
      size: 32
      num_packets: 30000

    patterns:
      - type: all_to_all
        iterations: 10

  - name: "FlowControlLinear"
    enable_flow_control: true
    fabric_setup:
      topology: Linear

    parametrization_params:
      ftype: [unicast, mcast]
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]
      size: [1024, 2048, 4096]

    defaults:
      num_packets: 100000

    patterns:
      - type: all_to_all

  - name: "MeshLowLatencyLooped"
    fabric_setup:
      topology: Mesh

    top_level_iterations: 10

    parametrization_params:
      ftype: [unicast, mcast]
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]

    defaults:
      size: 32
      num_packets: 30000

    patterns:
      - type: all_to_all
        iterations: 10

  - name: "FlowControlMeshLowLatency"
    enable_flow_control: true
    fabric_setup:
      topology: Mesh

    parametrization_params:
      ftype: [unicast, mcast]
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]
      size: [1024, 2048, 4096]

    defaults:
      num_packets: 100000

    patterns:
      - type: all_to_all

  - name: "MeshDynamicLooped"
    fabric_setup:
      topology: Mesh
      routing_type: Dynamic

    top_level_iterations: 10

    parametrization_params:
      ftype: [unicast, mcast]
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]

    defaults:
      size: 32
      num_packets: 30000

    patterns:
      - type: all_to_all
        iterations: 10

  - name: "FlowControlMeshDynamic"
    enable_flow_control: true
    fabric_setup:
      topology: Mesh
      routing_type: Dynamic

    parametrization_params:
      ftype: [unicast, mcast]
      ntype: [unicast_write, atomic_inc, fused_atomic_inc, unicast_scatter_write]
      num_links: [1, 2, 3, 4]
      size: [1024, 2048, 4096]

    defaults:
      num_packets: 100000

    patterns:
      - type: all_to_all
