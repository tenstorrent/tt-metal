# This file defines the test matrix for the Galaxy perf tests pipeline.

# Each entry represents a parallel job with the following keys:
#   name: The display name for the job in GitHub Actions.
#   cmd: The exact command to run for the test.
#   model: Model identifier for filtering (workflow_dispatch model selection).
#   sku: Machine type to target (e.g. wh_galaxy, bh_galaxy).
#   owner_id: The Slack user ID to notify on failure.
#   team: The team that owns the test.
#   timeout: The maximum allowed runtime for this job in minutes.
# Optional: arch, save-perf-data, tracy, model-type (for artifact naming).

# For max allowed timeout refer to .github/time_budget.yaml

# Wormhole Galaxy model perf tests
- name: Galaxy DiT SD3.5 model perf tests
  cmd: pytest models/tt_dit/tests/models/sd35/test_performance_sd35.py -k "4x8cfg1sp0tp1" --timeout=480
  model: sd35
  sku: wh_galaxy
  owner_id: U03FJB5TM5Y # Colman Glagovich
  team: models
  timeout: 50
  arch: wormhole_b0
  save-perf-data: true
  model-type: SD3.5

- name: Galaxy DiT Flux.1 model perf tests
  cmd: HF_HUB_CACHE=/mnt/MLPerf/huggingface/hub pytest models/tt_dit/tests/models/flux1/test_performance_flux1.py -k "wh_4x8sp0tp1" --timeout=500
  model: flux1-dev
  sku: wh_galaxy
  owner_id: U08TED0JM9D # Samuel Adesoye
  team: models
  timeout: 50
  arch: wormhole_b0
  save-perf-data: true
  model-type: Flux.1-Dev

- name: Galaxy DiT Motif model perf tests
  cmd: HF_HUB_CACHE=/mnt/MLPerf/huggingface/hub pytest models/tt_dit/tests/models/motif/test_performance_motif.py -k "4x8cfg1sp0tp1" --timeout=1000
  model: motif
  sku: wh_galaxy
  owner_id: U08TED0JM9D # Samuel Adesoye
  team: models
  timeout: 15
  arch: wormhole_b0
  save-perf-data: true
  model-type: Motif

- name: Galaxy DiT Wan2.2 model perf tests
  cmd: |
    export TT_DIT_CACHE_DIR="/tmp/TT_DIT_CACHE" && \
    pytest models/tt_dit/tests/models/wan2_2/test_performance_wan.py -k "wh_4x8sp1tp0 and resolution_720p and t2v" --timeout=1200
  model: wan2-2
  sku: wh_galaxy
  owner_id: U03FJB5TM5Y # Colman Glagovich
  team: models
  timeout: 35
  arch: wormhole_b0
  save-perf-data: true
  model-type: Wan2.2

- name: Galaxy Mochi model perf tests
  cmd: |
    export TT_DIT_CACHE_DIR="/tmp/TT_DIT_CACHE" && \
    export NO_PROMPT=1 && \
    pytest models/tt_dit/tests/models/mochi/test_performance_mochi.py -k "4x8sp1tp0 " --timeout=1000
  model: mochi
  sku: wh_galaxy
  owner_id: U09ELB03XRU # Stephen Osborne
  team: models
  timeout: 50
  arch: wormhole_b0
  save-perf-data: true
  model-type: mochi

- name: Galaxy DiT Qwen-Image model perf tests
  cmd: |
    export TT_DIT_CACHE_DIR="/tmp/TT_DIT_CACHE" && \
    pytest models/tt_dit/tests/models/qwenimage/test_performance_qwenimage.py -k "4x8" --timeout=1000
  model: qwenimage
  sku: wh_galaxy
  owner_id: U08TED0JM9D # Samuel Adesoye
  team: models
  timeout: 20
  arch: wormhole_b0
  save-perf-data: true
  model-type: QwenImage

- name: Galaxy Sentence Bert tests
  cmd: |
    pytest --timeout 600 models/demos/tg/sentence_bert/tests/device_perf_test.py && \
    python3 models/perf/merge_perf_results.py
  model: sentence_bert
  sku: wh_galaxy
  owner_id: U088413NP0Q # Ashai Reddy
  team: models
  timeout: 30
  arch: wormhole_b0
  save-perf-data: false
  model-type: sentence_bert
