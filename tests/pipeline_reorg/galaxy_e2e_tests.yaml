# This file defines the test matrix for the Galaxy e2e tests pipeline.

# Each entry represents a parallel job with the following keys:
#   name: The display name for the job in GitHub Actions.
#   cmd: The exact command to run for the test.
#   skus: A mapping of SKU names to their configuration.
#     Each SKU entry contains:
#       timeout: The maximum allowed runtime for this job in minutes on that SKU.
#   owner_id: The Slack user ID to notify on failure.
#   team: The team that owns the test.

# For max allowed timeout refer to .github/time_budget.yaml

# Wormhole Galaxy e2e tests
- name: Galaxy CCL tests
  cmd: pytest tests/nightly/tg/ccl --ignore tests/nightly/tg/ccl/moe
  skus:
    wh_galaxy:
      timeout: 35  
  owner_id: U05ACKAJTHS # Naif Tarafdar
  team: ttnn

- name: Galaxy MoE tests
  cmd: TT_MESH_GRAPH_DESC_PATH="tests/tt_metal/tt_fabric/custom_mesh_descriptors/single_galaxy_1x16_torus_graph_descriptor.textproto" pytest tests/nightly/tg/ccl/moe
  skus:
    wh_galaxy:
      timeout: 5    
  owner_id: U05ACKAJTHS # Naif Tarafdar
  team: ttnn

- name: Galaxy Fabric unit tests
  cmd: build/test/tt_metal/tt_fabric/fabric_unit_tests --gtest_filter="NightlyFabric*Fixture.*"
  skus:
    wh_galaxy:
      timeout: 25
    bh_galaxy:
      timeout: 30
  owner_id: U08UBDUKH6Z # Neel Nyamagoudar
  team: fabric

- name: Galaxy Fabric 2D Torus Nightly Tests
  cmd: ./build/test/tt_metal/perf_microbenchmark/routing/test_tt_fabric --test_config tests/tt_metal/tt_metal/perf_microbenchmark/routing/test_fabric_2d_torus_nightly.yaml
  skus:
    wh_galaxy:
      timeout: 45
  owner_id: U08UBDUKH6Z # Neel Nyamagoudar
  team: fabric

- name: Galaxy Fabric Multi-Mesh 4x4 and 2x4s stability tests
  cmd: |
    python tests/tt_metal/tt_fabric/utils/generate_rank_bindings.py
    tt-run --rank-binding 4x4_2x4_3_mesh_rank_binding.yaml --mpi-args "--allow-run-as-root --tag-output" ./build/test/tt_metal/perf_microbenchmark/routing/test_tt_fabric --test_config tests/tt_metal/tt_metal/perf_microbenchmark/routing/test_fabric_multi_mesh_stability_short_running.yaml
  skus:
    wh_galaxy:
      timeout: 15
  owner_id: U08UBDUKH6Z # Neel Nyamagoudar
  team: fabric

- name: Galaxy Fabric Multi-mesh 2x8 and 2x4s stability tests
  cmd: |
    python tests/tt_metal/tt_fabric/utils/generate_rank_bindings.py
    tt-run --rank-binding 2x8_2x4_3_mesh_rank_binding.yaml --mpi-args "--allow-run-as-root --tag-output" ./build/test/tt_metal/perf_microbenchmark/routing/test_tt_fabric --test_config tests/tt_metal/tt_metal/perf_microbenchmark/routing/test_fabric_multi_mesh_stability_short_running.yaml
  skus:
    wh_galaxy:
      timeout: 15
  owner_id: U08UBDUKH6Z # Neel Nyamagoudar
  team: fabric

# Blackhole Galaxy e2e tests
- name: BH Galaxy CCL tests
  cmd: pytest tests/ttnn/unit_tests/operations/ccl/blackhole_CI/galaxy/galaxy_nightly
  skus:
    bh_galaxy:
      timeout: 40
  owner_id: U05ACKAJTHS # Naif Tarafdar, Camilo Vega
  team: ttnn

- name: BH Galaxy Fabric Torus Stability Tests
  cmd: ./build/test/tt_metal/perf_microbenchmark/routing/test_tt_fabric --test_config tests/tt_metal/tt_metal/perf_microbenchmark/routing/test_bh_glx_2d_torus_stability.yaml
  skus:
    bh_galaxy:
      timeout: 20
  owner_id: U08UBDUKH6Z # Neel Nyamagoudar
  team: fabric

- name: BH Galaxy Socket Pipeline Latency SendRecv Single Galaxy
  cmd: |
    python tests/tt_metal/tt_fabric/utils/generate_rank_bindings.py
    tt-run --rank-binding bh_galaxy_split_4x2_multi_mesh_rank_binding.yaml --mpi-args "--allow-run-as-root --tag-output" ./build/test/tt_metal/multihost/socket_pipeline/multiprocess/unit_tests_pipeline --gtest_filter="*SendRecvPipelineSingleGalaxy*"
  skus:
    bh_galaxy:
      timeout: 10
  owner_id: U08UBDUKH6Z # Neel Nyamagoudar
  team: fabric
