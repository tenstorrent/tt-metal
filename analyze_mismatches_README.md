# Analyze Mismatches Tool

## Overview
This tool analyzes the `ttnn_add_mismatches.bin` file generated by the test_add_2D_tensors test and provides comprehensive statistics and analysis.

## Compilation
```bash
g++ -std=c++14 -O2 -Wall -Wextra -o analyze_mismatches analyze_mismatches.cpp
```

## Usage
```bash
./analyze_mismatches [filename]
```
Default filename: `ttnn_add_mismatches.bin`

## Output

### 1. Frequency Tables
- **Table 1**: Top 100 most frequent left operand (input_a) values in mismatches
- **Table 2**: Top 100 most frequent values across both operands (combined)

### 2. Histograms
The tool generates the following histograms:

#### ULP Difference Histogram
- Shows distribution of Units in Last Place (ULP) errors
- Includes min, max, mean statistics
- Cumulative distribution for common ULP ranges (1, 2, 5, 10, 50, 100, 1000, 10000)

#### Signs Same Histogram
- Distribution of mismatches where both operands have same sign (Yes/No)

#### Exponent Difference Histogram
- Distribution of differences between larger and smaller exponents
- Numeric distribution with statistics

#### Larger Exponent Histogram
- Distribution of the larger exponent value from each mismatch
- Range: 0-255 (8-bit exponent)

#### Smaller Exponent Histogram
- Distribution of the smaller exponent value from each mismatch
- Range: 0-255 (8-bit exponent)

#### Left Operand Exponent Histogram
- Distribution of exponent values for the left operand only
- Shows which exponent values in the left operand are involved in mismatches
- Range: 0-255 (8-bit exponent)

#### Right Operand Exponent Histogram
- Distribution of exponent values for the right operand only
- Shows which exponent values in the right operand are involved in mismatches
- Range: 0-255 (8-bit exponent)

#### Left Operand Type Histogram
- Distribution of left operand types:
  - Normal: Regular floating-point numbers
  - Subnormal: Numbers with exponent = 0, mantissa != 0
  - +Inf: Positive Infinity (sign = 0, exponent = 0xFF, mantissa = 0)
  - -Inf: Negative Infinity (sign = 1, exponent = 0xFF, mantissa = 0)
  - NaN: Not a Number (exponent = 0xFF, mantissa != 0)
  - +Zero: Positive Zero (sign = 0, exponent = 0, mantissa = 0)
  - -Zero: Negative Zero (sign = 1, exponent = 0, mantissa = 0)

#### Right Operand Type Histogram
- Same as above, but for right operand

### 3. Percentage Formatting
Histograms use special formatting for extreme percentages:
- **"< 0.01%"**: Shown for values between 0% and 0.01%
- **"> 99.9%"**: Shown for values between 99.9% and 100%
- Standard formatting (e.g., "45.67%") for all other values

### 4. CSV Files

#### Top 10 Most Frequent Values
The tool generates CSV files for the **top 10 most frequent values** (regardless of whether they appear as left or right operand).

**Location:**
- Directory: `./mismatch_csvs/`
- Filename format: `operand_a_0xXXXX.csv`

#### Filtered CSV File
Additionally, a filtered CSV file is generated with up to 100 mismatches matching specific criteria:
- Same input sign (both positive or both negative)
- Both operands are normal numbers (not subnormal, inf, nan, or zero)
- Exponent difference equals exactly 9

**Location:**
- Directory: `./mismatch_csvs/`
- Filename: `filtered_exp9_same_sign_normal.csv`

#### CSV Format
Each CSV contains the following columns:

| Column | Description |
|--------|-------------|
| Left Operand (hex) | Left input operand in hexadecimal |
| Right Operand (hex) | Right input operand in hexadecimal |
| Result (hex) | Actual hardware result |
| Expected (hex) | Expected correct result |
| ULP Error | Units in Last Place difference |
| Signs Same | Yes/No if both inputs have same sign |
| Larger Exponent | Maximum of the two input exponents |
| Smaller Exponent | Minimum of the two input exponents |
| Exponent Diff | Difference between exponents |
| Left Type | Classification (Normal/Subnormal/+Inf/-Inf/NaN/+Zero/-Zero) |
| Right Type | Classification (Normal/Subnormal/+Inf/-Inf/NaN/+Zero/-Zero) |
| Left Exp | Left operand exponent (0-255) |
| Right Exp | Right operand exponent (0-255) |
| Left Mantissa | Left operand mantissa (0-127) |
| Right Mantissa | Right operand mantissa (0-127) |

#### Importing to Google Sheets
1. Open Google Sheets
2. File → Import → Upload
3. Select CSV file
4. Import location: Replace current sheet / Insert new sheet
5. Separator type: Comma
6. Convert text to numbers: Yes

## BFloat16 Format
The tool analyzes bfloat16 (Brain Floating Point) format:
- 1 bit: Sign
- 8 bits: Exponent (biased by 127)
- 7 bits: Mantissa (fraction)

Total: 16 bits
