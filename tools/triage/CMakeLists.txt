# Build for triage is optional build of stub files for inspector RPC
# Generate Inspector RPC stub file
set(TRIAGE_INSPECTOR_RPC_STUB_FILE ${CMAKE_CURRENT_SOURCE_DIR}/inspector_capnp.pyi)
set(TRIAGE_INSPECTOR_RPC_CAPNP ${CMAKE_CURRENT_SOURCE_DIR}/inspector_rpc.capnp)
set(TRIAGE_RUNTIME_INSPECTOR_RPC_CAPNP ${CMAKE_CURRENT_SOURCE_DIR}/runtime_rpc.capnp)
set(TRIAGE_TTNN_INSPECTOR_RPC_CAPNP ${CMAKE_CURRENT_SOURCE_DIR}/ttnn_rpc.capnp)
set(TRIAGE_GENERATE_RPC_STUB ${PROJECT_SOURCE_DIR}/scripts/generate_rpc_stub.py)
add_custom_command(
    OUTPUT
        ${TRIAGE_INSPECTOR_RPC_STUB_FILE}
    COMMAND
        python3 ${TRIAGE_GENERATE_RPC_STUB} ${TRIAGE_INSPECTOR_RPC_STUB_FILE} ${PROJECT_SOURCE_DIR}/tt_metal/api
        ${TRIAGE_RUNTIME_INSPECTOR_RPC_CAPNP} ${TRIAGE_INSPECTOR_RPC_CAPNP} ${TRIAGE_TTNN_INSPECTOR_RPC_CAPNP}
    DEPENDS
        ${TRIAGE_INSPECTOR_RPC_CAPNP}
        ${TRIAGE_RUNTIME_INSPECTOR_RPC_CAPNP}
        ${TRIAGE_TTNN_INSPECTOR_RPC_CAPNP}
        ${TRIAGE_GENERATE_RPC_STUB}
    COMMENT
        "Generating RPC stub for ${TRIAGE_INSPECTOR_RPC_CAPNP}, ${TRIAGE_RUNTIME_INSPECTOR_RPC_CAPNP}, ${TRIAGE_TTNN_INSPECTOR_RPC_CAPNP}"
)
add_custom_target(
    inspector_rpc_stub
    ALL
    DEPENDS
        ${TRIAGE_INSPECTOR_RPC_STUB_FILE}
        ${TRIAGE_RUNTIME_INSPECTOR_RPC_CAPNP}
        ${TRIAGE_TTNN_INSPECTOR_RPC_CAPNP}
)
