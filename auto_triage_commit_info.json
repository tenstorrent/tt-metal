{
  "metadata": {
    "workflow": "galaxy-quick",
    "subjob": "quick-wh-glx-quick",
    "last_success": {
      "commit": "8221a4dd4b2959589808a7bff7ccfd5596ac7df0",
      "run_url": "https://github.com/tenstorrent/tt-metal/actions/runs/19475473285",
      "run_id": "19475473285",
      "job_url": "https://github.com/tenstorrent/tt-metal/actions/runs/19475473285/job/55735804849"
    },
    "first_failure": {
      "commit": "8e97c34c8cf6e3041fe7e119e3f1ff6073d20e04",
      "run_url": "https://github.com/tenstorrent/tt-metal/actions/runs/19476158438",
      "run_id": "19476158438",
      "job_url": "https://github.com/tenstorrent/tt-metal/actions/runs/19476158438/job/55737180254"
    },
    "compare_url": "https://github.com/tenstorrent/tt-metal/compare/8221a4dd4b2959589808a7bff7ccfd5596ac7df0...8e97c34c8cf6e3041fe7e119e3f1ff6073d20e04",
    "commit_count": 1
  },
  "commits": [
    {
      "commit": "8e97c34c8cf6e3041fe7e119e3f1ff6073d20e04",
      "commit_short": "8e97c34c",
      "commit_date": "2025-11-18 08:58:16 -0800",
      "commit_subject": "Update ethernet channel ordering logic (#32207)",
      "pr_number": "32207",
      "pr_title": "Update ethernet channel ordering logic",
      "pr_url": "https://github.com/tenstorrent/tt-metal/pull/32207",
      "pr_description": "### Ticket\r\nhttps://github.com/tenstorrent/tt-metal/issues/28352 and https://github.com/tenstorrent/tt-metal/issues/32492\r\n\r\n### Problem description\r\nThe way that order_ethernet_channels currently orders channels is low to high. This does not work for blackhole.\r\nThere is an assumption in the code that when there are multiple connections between two neighbors, both chips have monotonically increasing ports connected to each other.\r\nFor example, if chip 1 port 3, 5, 6, 11 are connected to chip 2 ports 1, 2, 5, 6, then the connected ports are 3-1, 5-2, 6-5, 11-6. And even if we order the port arrays on both chips individually, the ordered port lists will still map 1-1. Meaning chip 1  ordered port array[0] connects to chip 2 ordered port array[0].\r\nBecause of this, current code would sort the ports on each chip independently.\r\n\r\nThis however does not work if the port pairing between chips is not monotonically increasing. This is happening on QB GE where chip 1 ports 1,2,5,6 can be connected to chip 2 ports 7, 4, 2, 9.\r\nExisting ethernet port connectivity code would think that after sorting, chip 1 port 1 is connected to chip2 port 2, chip 1 port 5 is connected to chip 2 port 7. Which is incorrect.\r\n\r\nThe fix here is to always use the same chip, in this case the chip with higher physical chip id, for sorting operations.\r\n\r\n### What's changed\r\nModified the algorithm for ordering ethernet channels to always sort with respect to the order of the higher number phys_chip_id between two chips\r\n\r\n### Checklist\r\n- [x] [All post commit](https://github.com/tenstorrent/tt-metal/actions/workflows/all-post-commit-workflows.yaml) CI passes - https://github.com/tenstorrent/tt-metal/actions/runs/19247508764\r\n- [x] [Blackhole Post commit](https://github.com/tenstorrent/tt-metal/actions/workflows/blackhole-post-commit.yaml) CI with demo tests passes (if applicable) - https://github.com/tenstorrent/tt-metal/actions/runs/19247511945\r\n- [ ] [Model regression](https://github.com/tenstorrent/tt-metal/actions/workflows/perf-models.yaml) CI passes (if applicable)\r\n- [ ] [Device performance regression](https://github.com/tenstorrent/tt-metal/actions/workflows/perf-device-models.yaml) CI passes (if applicable)\r\n- [ ] (For models and ops writers) [Single-card demo tests](https://github.com/tenstorrent/tt-metal/actions/workflows/single-card-demo-tests.yaml) CI passes (if applicable) See [recommended dev flow](https://github.com/tenstorrent/tt-metal/blob/main/models/docs/MODEL_ADD.md#a-recommended-dev-flow-on-github-for-adding-new-models).\r\n- [ ] [Galaxy quick](https://github.com/tenstorrent/tt-metal/actions/workflows/galaxy-quick.yaml) CI passes (if applicable)\r\n- [ ] [Galaxy demo tests, for Llama](https://github.com/tenstorrent/tt-metal/actions/workflows/galaxy-demo-tests.yaml) CI passes, if applicable, because of current Llama work\r\n- [ ] (For runtime and ops writers) [T3000 unit tests](https://github.com/tenstorrent/tt-metal/actions/workflows/t3000-unit-tests.yaml) CI passes (if applicable, since this is run on push to main)\r\n- [ ] (For models and ops writers) [T3000 demo tests](https://github.com/tenstorrent/tt-metal/actions/workflows/t3000-demo-tests.yaml) CI passes (if applicable, since this is required for release)\r\n- [ ] New/Existing tests provide coverage for changes",
      "authors": [
        "Neel Nyamagoudar",
        "nnyamagoudar-TT"
      ],
      "copilot_overview": "This PR updates the ethernet channel ordering logic to support Blackhole by modifying the algorithm to sort channels based on the higher ASIC ID between two connected chips, rather than always sorting low to high.\n\n- Modified `order_ethernet_channels()` to determine neighbor ASIC IDs for each direction\n- Updated sorting logic to compare source vs neighbor ASIC IDs and sort accordingly\n- When source ASIC ID is lower, sort by destination channel coordinates and map back to source channels"
    }
  ]
}
